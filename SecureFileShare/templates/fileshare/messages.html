{% extends 'fileshare/base.html' %}




{% block content %}
{% load staticfiles %}
<link href="{% static 'css/messagescss.css' %}" rel="stylesheet">


<div align="left">
  <script src="https://use.fontawesome.com/45e03a14ce.js"></script>
<div class="pull-left" id="themasterdiv">
   <div class="container">
      <div class="chat_container">
         <div class="col-sm-3 chat_sidebar">
    	 <div class="row">
            <div id="custom-search-input">
               <div class="input-group col-md-12">
                  <input type="text" class="  search-query form-control" placeholder="Conversation" />
                  <button class="btn btn-danger" type="button">
                  <span class=" glyphicon glyphicon-search"></span>
                  </button>
               </div>
            </div>
            <div class="dropdown all_conversation">
               <button class="dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               <i class="fa fa-weixin" aria-hidden="true"></i>
               All Conversations
               <span class="caret pull-right"></span>
               </button>
               <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                  <li><a href="#"> All Conversation </a>  <ul class="sub_menu_ list-unstyled">
                  <li><a href="#"> All Conversation </a> </li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li><a href="#">Separated link</a></li>
               </ul>
			   </li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li><a href="#">Separated link</a></li>
               </ul>
            </div>
            <div class="member_list">
               <ul class="list-unstyled" id="conversationlist">
                  {% if conversation_list %}
                    {% for conversation in conversation_list %}
                 <li class="left clearfix" onclick="loadMessages(this)">
                     <div class="chat-body clearfix">
                        <div class="header_sec">
                           <strong class="primary-font">{{conversation.reciever_name}}</strong> <strong class="pull-right">
                           {{conversation.recently_used.time}}</strong>
                        </div>
                        <div class="contact_sec">
                           <strong class="primary-font"></strong> <span class="badge pull-right">{{conversation.messages.count}}</span>
                        </div>
                     </div>
                  </li>
                    {% endfor %}
                    {% else %}
                 <li class="left clearfix">
                    <div class="chat-body clearfix">
                        <div class="header_sec">
                           <strong class="primary-font">No Conversations Available.</strong> <strong class="pull-right">
                           </strong>
                        </div>
                        <div class="contact_sec">
                           <strong class="primary-font"></strong> <span class="badge pull-right"></span>
                        </div>
                     </div>
                 </li>
                    {% endif %}

               </ul>
            </div></div>
         </div>
         <!--chat_sidebar-->


         <div class="col-sm-9 message_section">
		 <div class="row">
		 <div class="new_message_head">
		 <div class="pull-left"><button><i class="fa fa-plus-square-o" aria-hidden="true"></i> New Message</button></div><div class="pull-right"><div class="dropdown">
  <button class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-cogs" aria-hidden="true"></i>  Setting
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
    <li><a href="#">Action</a></li>
    <li><a href="#">Profile</a></li>
    <li><a href="#">Logout</a></li>
  </ul>
</div></div>
		 </div><!--new_message_head-->

		 <div class="chat_area">
		 <ul class="list-unstyled" id="messagelist">


		 </ul>
		 </div><!--chat_area-->
          <div class="message_write">
    	 <textarea class="form-control" placeholder="type a message"></textarea>
		 <div class="clearfix"></div>
		 <div class="chat_bottom"><a href="#" class="pull-left upload_btn"><i class="fa fa-cloud-upload" aria-hidden="true"></i>
 Add Files</a>
 <a href="#" class="pull-right btn btn-success">
 Send</a></div>
		 </div>
		 </div>
         </div> <!--message_section-->
      </div>
   </div>
</div>
</div>

<script>

   var messagestoload = [];
    {% if message_list %}
      {% for m in message_list %}
        var currentconvo = [];
          {% for cm in m %}
              var currentmessage = ["{{cm.messagecontent}}","{{cm.time}}",false];
              {% if cm.sender == user %}
                currentmessage[2]=true;
              {% endif %}
            currentconvo.push(currentmessage);
          {% endfor %}
        messagestoload.push(currentconvo);
      {% endfor %}
    {% endif %}



  function loadMessages(elmnt) {
    var convos = document.getElementById("conversationlist").children;
    elmnt.style.backgroundColor = '#2E86C1';
    elmnt.style.color = 'white';

    var convocount = document.getElementById("conversationlist").childElementCount;
    var convo = 0;
    while (elmnt != convos.item(convo) && convo < convocount ) {
      convo++
    }

    var table = document.getElementById("messagelist");
    table.innerHTML = '';
    if(messagestoload) {
      var i = messagestoload[convo].length - 1;
      for (i; i >= 0; i--) {
        var item = document.createElement("li");
        if (messagestoload[convo][i][2]) {
          item.setAttribute("class", "left clearfix");
        }
        else {
          item.setAttribute("class", "left clearfix admin_chat");
        }

        item.appendChild(document.createElement("div"));
        if (messagestoload[convo][i][2]) {
          item.firstElementChild.setAttribute("class", "chat-body2 clearfix");
        }
        else {
          item.firstElementChild.setAttribute("class", "chat-body1 clearfix");
        }

        item.firstElementChild.appendChild(document.createElement("p"));
        item.firstElementChild.firstElementChild.innerText = messagestoload[convo][i][0];
        item.firstElementChild.appendChild(document.createElement("div"));
        if (messagestoload[convo][i][2]) {
          item.firstElementChild.children[1].setAttribute("class", "chat_time pull-right");
        }
        else {
          item.firstElementChild.children[1].setAttribute("class", "chat_time pull-left");
        }

        item.firstElementChild.children[1].innerText = messagestoload[convo][i][1];
        table.appendChild(item);
      }
    }
    else {


    }
  }

</script>




{% endblock %}

{% block javascript %}

{% endblock %}